/*! Readable Version: html5-thor 2014-03-28 */
/* jshint ignore:start */
var CBATOOLS = CBATOOLS || {};

CBATOOLS.DEBUG = false;

/* jshint ignore:end */
CBATOOLS.init = function() {
    "use strict";
    var body = document.body, controller = body.getAttribute("data-controller"), action = body.getAttribute("data-action");
    CBATOOLS.exec("common");
    CBATOOLS.exec(controller);
    CBATOOLS.exec(controller, action);
};

/* Initialisation methods for the HTML Templates */
var CBATOOLS_INIT = {
    common: {
        init: function() {
            "use strict";
        }
    },
    tools: {
        counter: function() {
            "use strict";
            CBATOOLS.tools.init();
            CBATOOLS.anotherModule.log();
            // Start the 'loadie' plugin now to show around 50% has completed (just an ex example)
            $("body").loadie(.5);
        }
    }
};

/* Standard Garber-Irish Implementation  */
CBATOOLS.exec = function(controller, action) {
    "use strict";
    var ns = CBATOOLS_INIT, actionOveride = action === undefined ? "init" : action;
    if (controller !== "" && ns[controller] && typeof ns[controller][actionOveride] === "function") {
        ns[controller][actionOveride]();
    }
};

// This file is required to kick off the CBATOOLS.init() after the build takes place
// Its needed because the yepnope code in _init.js only works in development mode
$(function() {
    "use strict";
    CBATOOLS.init();
});

(function(NAMESPACE) {
    "use strict";
    NAMESPACE.anotherModule = {
        log: function() {
            console.log("I'm another Module");
        }
    };
})(CBATOOLS);

(function(NAMESPACE) {
    "use strict";
    NAMESPACE.tools = {};
    NAMESPACE.tools.init = function() {
        var initialValue = 14;
        var targetValue = 15;
        var sliderWidth = 150;
        var sliderStepWidth = sliderWidth / targetValue;
        var toolSetup = function(newInitialValue) {
            initialValue = newInitialValue;
            if (initialValue >= 0 && initialValue <= targetValue) {
                // initial state reset
                $(".brokerage-tool").fadeIn();
                $(".pointer").show();
                $(".status").show();
                $(".checked").hide();
                $(".goal-flag").removeClass("glow");
                $(".dyn-count").text("$" + (targetValue - initialValue));
                $(".dyn-target-count").text("$" + targetValue);
                $(".dyn-pointer-val").text("$" + initialValue);
                // delay animation so it looks nice
                setTimeout(function() {
                    $("body").loadie(1);
                    // exaple hook of 'loadie' plugin to show progress
                    $(".title-box").animate({
                        opacity: 1,
                        top: -1530
                    }, 1e3);
                    $(".bar-inner").css("width", sliderStepWidth * initialValue);
                    $(".pointer").css("left", sliderStepWidth * initialValue);
                    $(".pointer").on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd", function() {
                        if (parseInt(initialValue) === targetValue) {
                            $(".pointer").fadeOut();
                            $(".status").fadeOut();
                            $(".checked").fadeIn();
                            $(".goal-flag").addClass("glow");
                        } else {
                            $(".dyn-pointer-val").text("$" + initialValue);
                        }
                    });
                }, 1e3);
            } else {
                alert("Error! Outside acceptable range of 0 - 15");
            }
        };
        toolSetup(initialValue);
        // DEBUG
        $("#new-val").on("change", function() {
            toolSetup($(this).val());
        });
    };
})(CBATOOLS);